<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <header>
    <nav class="topNav">
      <div class="leftNav"><img src="images/logoTitlr.JPG" alt="StockManTextLogo"></div>
      <div class="rightNav">
        <li><a href="index.html">首頁</a></li>
        <li><a href="why.html">理財與股票</a></li>
        <li class="active"><a href="search.html">查詢股票</a></li>
        <li><a href="recommend.html">推薦券商與地圖</a></li>
      </div>
      <div class="navMenu"><i class='bx bx-menu'></i></div>
      <div class="mobileMenu d-none">
        <div class="menuClose"><i class='bx bx-x'></i></div>
        <li><a href="index.html">首頁</a></li>
        <li><a href="why.html">理財與股票</a></li>
        <li><a href="search.html">查詢股票</a></li>
        <li><a href="recommend.html">推薦券商與地圖</a></li>
      </div>
    </nav>
  </header>

  <!-- search & record -->
  <section class="search">
    <div class="searchContainer">
      <div class="l-searchRecord">
        <h3>搜尋紀錄</h3>
        <ul id="recordList">
          <!-- <li>2330 台積電 </li>
          <li>9942 茂順 </li>
          <li>006208 富邦台50 </li> -->
        </ul>
      </div>
      <div class="r-search">
        <div class="SContainer">
          <h3 class="searchTitle">搜尋股票</h3>
          <div class="searchInput">
            <input id="searchStock" class="" placeholder="請輸入股票代碼">
            <button id="searchStockBtn" class="">查詢</button>
          </div>
        </div>
        <div id="result" class="result">
          <!-- <h1 style="text-align: center;">112年02月 2330 台積電 各日成交資訊</h1>
          <table border="1" >
            <tbody>
              <tr>
                <th>日期</th>
                <th>成交股數</th>
                <th>成交金額</th>
                <th>開盤價</th>
                <th>收盤價</th>
                <th>漲跌價差</th>
              </tr>
              <tr>
                <td>112/02/17</td>
                <td>29,673,053</td>
                <td>15,385,668,299</td>
                <td>524.00</td>
                <td>518.00</td>
                <td><span style="color:red">+6.00</span></td>
              </tr>
              <tr>
                <td>112/02/16</td>
                <td>33,509,968</td>
                <td>17,692,691,883</td>
                <td>528.00</td>
                <td>528.00</td>
                <td>0.00</td>
              </tr>
              <tr>
                <td>112/02/15</td>
                <td>66,068,713</td>
                <td>34,751,111,404</td>
                <td>526.00</td>
                <td>525.00</td>
                <td><span style="color:red">+1.00</span></td>
              </tr>
              <tr>
                <td>112/02/14</td>
                <td>23,855,974</td>
                <td>12,990,943,260</td>
                <td>544.00</td>
                <td>545.00</td>
                <td><span style="color:green">-1.00</span></td>
              </tr>
              <tr>
                <td>112/02/13</td>
                <td>23,903,151</td>
                <td>12,921,896,752</td>
                <td>544.00</td>
                <td>541.00</td>
                <td><span style="color:red">+3.00</span></td>
              </tr>
              <tr>
                <td>112/02/10</td>
                <td>30,445,088</td>
                <td>16,545,221,176</td>
                <td>544.00</td>
                <td>545.00</td>
                <td><span style="color:green">-1.00</span></td>
              </tr>
              <tr>
                <td>112/02/09</td>
                <td>22,311,345</td>
                <td>12,026,317,167</td>
                <td>540.00</td>
                <td>540.00</td>
                <td>0.00</td>
              </tr>
              <tr>
                <td>112/02/08</td>
                <td>37,633,169</td>
                <td>20,247,927,642</td>
                <td>538.00</td>
                <td>540.00</td>
                <td><span style="color:green">-2.00</span></td>
              </tr>
              <tr>
                <td>112/02/07</td>
                <td>24,362,116</td>
                <td>12,767,910,080</td>
                <td>524.00</td>
                <td>523.00</td>
                <td><span style="color:red">+1.00</span></td>
              </tr>
              <tr>
                <td>112/02/06</td>
                <td>32,208,918</td>
                <td>17,041,821,849</td>
                <td>532.00</td>
                <td>526.00</td>
                <td><span style="color:red">+6.00</span></td>
              </tr>
              <tr>
                <td>112/02/03</td>
                <td>34,156,234</td>
                <td>18,439,613,447</td>
                <td>540.00</td>
                <td>542.00</td>
                <td><span style="color:green">-2.00</span></td>
              </tr>
              <tr>
                <td>112/02/02</td>
                <td>46,523,592</td>
                <td>25,091,483,557</td>
                <td>538.00</td>
                <td>540.00</td>
                <td><span style="color:green">-2.00</span></td>
              </tr>
            </tbody>
          </table> -->
        </div>

      </div>
    </div>
  </section>


  <!-- top20 -->
  <section class="top20Section">
    <div class="container">
      <h2 class="top20Title">昨日成交前20名</h2>
      <div class="container m-auto">
        <div id="top20">
          <!-- <table class="top20table" border="1"><tbody><tr><th>排名</th><th>證券代號</th><th>證券名稱</th><th>成交股數</th><th>開盤價</th><th>收盤價</th><th>漲跌價差</th></tr><tr><td>1</td><td>2610</td><td>華航</td><td>261,250,359</td><td>19.70</td><td>21.00</td><td><span style="color:red">+1.30</span></td></tr><tr><td>2</td><td>00632R</td><td>元大台灣50反1</td><td>216,600,746</td><td>5.37</td><td>5.34</td><td><span style="color:green">-0.03</span></td></tr><tr><td>3</td><td>2618</td><td>長榮航</td><td>178,163,412</td><td>28.60</td><td>29.70</td><td><span style="color:red">+1.10</span></td></tr><tr><td>4</td><td>00878</td><td>國泰永續高股息</td><td>145,267,925</td><td>16.97</td><td>17.03</td><td><span style="color:red">+0.06</span></td></tr><tr><td>5</td><td>3481</td><td>群創</td><td>126,348,217</td><td>13.30</td><td>13.60</td><td><span style="color:red">+0.30</span></td></tr><tr><td>6</td><td>1605</td><td>華新</td><td>99,790,399</td><td>54.80</td><td>56.30</td><td><span style="color:red">+1.50</span></td></tr><tr><td>7</td><td>2409</td><td>友達</td><td>80,995,009</td><td>17.50</td><td>17.95</td><td><span style="color:red">+0.45</span></td></tr><tr><td>8</td><td>00637L</td><td>元大滬深300正2</td><td>63,173,443</td><td>16.63</td><td>16.89</td><td><span style="color:red">+0.26</span></td></tr><tr><td>9</td><td>2303</td><td>聯電</td><td>56,382,709</td><td>50.40</td><td>50.10</td><td><span style="color:green">-0.30</span></td></tr><tr><td>10</td><td>2344</td><td>華邦電</td><td>47,159,717</td><td>22.60</td><td>23.40</td><td><span style="color:red">+0.80</span></td></tr><tr><td>11</td><td>2201</td><td>裕隆</td><td>47,087,759</td><td>78.90</td><td>81.50</td><td><span style="color:red">+2.60</span></td></tr><tr><td>12</td><td>1513</td><td>中興電</td><td>41,028,551</td><td>87.80</td><td>87.80</td><td>0.00</td></tr><tr><td>13</td><td>2317</td><td>鴻海</td><td>39,872,101</td><td>103.00</td><td>103.50</td><td><span style="color:red">+0.50</span></td></tr><tr><td>14</td><td>6116</td><td>彩晶</td><td>38,912,827</td><td>12.25</td><td>12.95</td><td><span style="color:red">+0.70</span></td></tr><tr><td>15</td><td>2731</td><td>雄獅</td><td>38,021,260</td><td>132.50</td><td>137.00</td><td><span style="color:red">+4.50</span></td></tr><tr><td>16</td><td>3037</td><td>欣興</td><td>34,635,533</td><td>139.50</td><td>138.50</td><td><span style="color:green">-1.00</span></td></tr><tr><td>17</td><td>2886</td><td>兆豐金</td><td>33,797,080</td><td>33.25</td><td>33.40</td><td><span style="color:red">+0.15</span></td></tr><tr><td>18</td><td>2330</td><td>台積電</td><td>33,509,968</td><td>528.00</td><td>528.00</td><td>0.00</td></tr><tr><td>19</td><td>00671R</td><td>富邦NASDAQ反1</td><td>33,118,123</td><td>5.73</td><td>5.72</td><td><span style="color:green">-0.01</span></td></tr><tr><td>20</td><td>0056</td><td>元大高股息</td><td>31,021,361</td><td>27.07</td><td>27.33</td><td><span style="color:red">+0.26</span></td></tr></tbody></table> -->
        </div>
      </div>
    </div>

  </section>

  <!-- footer -->
  <footer>
    <div class="m-auto container">
      <div class="f-content d-grid">
        <img src="images/logo.JPG" alt="">
        <div class="f-link">
          <li class="nav-item text-center">
            <a class="nav-link active" aria-current="page" href="index.html">前往首頁</a>
          </li>
          <li class="nav-item text-center">
            <a class="nav-link" href="search.html">查詢股票</a>
          </li>
          <li class="nav-item text-center">
            <a class="nav-link" href="qa.html">常見問題</a>
          </li>
        </div>
      </div>
    </div>
  </footer>
  <!-- <script src="js/search.js"></script> -->
  <script>
    // 漢堡選單RWD js
    let menuClose = document.getElementsByClassName("menuClose")[0];
    let mobileMenu = document.getElementsByClassName("mobileMenu")[0];
    let navMenu = document.getElementsByClassName("navMenu")[0];

    menuClose.addEventListener('click', function () {
      mobileMenu.classList.add("d-none");
    })

    navMenu.addEventListener('click', function () {
      mobileMenu.classList.remove("d-none")
    })

    function getTodayDate() {
      let year = new Date().getFullYear();
      let month = new Date().getMonth() + 1;
      let day = new Date().getDate();
      let dayOfWeek = new Date().getDay();
      dayOfWeek = dayOfWeek.toString();

      month = month.toString();
      year = year.toString();
      day = day.toString();

      if (month.length == 1) {
        month = "0" + month;
      }

      if (day.length == 1) {
        day = "0" + day;
      }
      return year + month + day;
    }

    function getLastTradeDate() {
      let year = new Date().getFullYear();
      let month = new Date().getMonth() + 1;
      let day = new Date().getDate();
      let dayOfWeek = new Date().getDay();
      dayOfWeek = dayOfWeek.toString();
      switch (dayOfWeek) {
        case "6":
          day = day - 1;
          break
        case "0":
          day = day - 2;
          break
        case "1":
          day = day - 3;
          break
      }
      month = month.toString();
      year = year.toString();
      day = day.toString();

      if (month.length == 1) {
        month = "0" + month;
      }

      if (day.length == 1) {
        day = "0" + day;
      }
      let date = year + month + day;

      date = (parseInt(date) - 1).toString();

      return date;
    }

    let stroage = [];

    function getTenDay(date, stockNum) {

      fetch(`https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=json&date=${date}&stockNo=${stockNum}`)
        .then((res) => {
          const data = res.json();
          return data;
        })
        .then((stocks) => {

          let container = document.getElementById("result");
          container.innerHTML = "";
          let h1 = document.createElement("h1")
          let title = document.createTextNode(stocks.title);
          h1.style.textAlign = "center"
          h1.appendChild(title);
          container.appendChild(h1);

          let record = document.getElementById("recordList");
          let li = document.createElement("li");
          li.setAttribute("id", `s${stockNum}`);
          let liStr = stocks.title.substr(8, 19);
          let liText = document.createTextNode(liStr);
          li.appendChild(liText);
          record.append(li);

          // console.log(stocks)//除錯用

          let table = document.createElement("table");
          table.setAttribute("border", "1");

          container.appendChild(table);

          let tHead = stocks.fields;

          // 暫存


          let row = table.insertRow();
          for (let i = 0; i < tHead.length - 1; i++) {
            if (i == 4 || i == 5) { continue }
            let th = document.createElement("th");
            th.innerHTML = tHead[i];
            row.appendChild(th);
          }

          let tContent = stocks.data;

          let stockdata = { "title": stockNum, "data": tContent };
          stroage.push(stockdata);
          console.log(stroage);
          // console.log(tContent); //除錯用

          let tContentL = tContent.length - 1;
          for (let i = tContentL; i > 0; i--) {
            let tableRow = table.insertRow();

            for (let j = 0; j < tContent[i].length - 1; j++) {
              if (j == 4 || j == 5) { continue }

              let rowTd = tableRow.insertCell();
              if (j == 7) {
                if (parseFloat(tContent[i][3]) - parseFloat(tContent[i][6]) > 0) {
                  rowTd.innerHTML = `<span style='color:red'>+${(parseFloat(tContent[i][3]) - parseFloat(tContent[i][6])).toFixed(2)}</span>`
                } else if (parseFloat(tContent[i][3]) - parseFloat(tContent[i][6]) < 0) {
                  rowTd.innerHTML = `<span style='color:green'>${(parseFloat(tContent[i][3]) - parseFloat(tContent[i][6])).toFixed(2)}</span>`
                } else {
                  rowTd.innerHTML = (parseFloat(tContent[i][3]) - parseFloat(tContent[i][6])).toFixed(2)
                }
              } else {
                rowTd.innerHTML = tContent[i][j];
              }

            }
          }

        })
        .catch((error) => {
          console.log(`Error: ${error}`);
          let container = document.getElementById("result");
          container.innerHTML = "";
          let h1 = document.createElement("h1")
          let title = document.createTextNode("請輸入正確的股票代碼");
          h1.style.textAlign = "center";
          h1.appendChild(title);
          container.appendChild(h1);
        })
    }

    function top20stocks(idname) {
      let date = getLastTradeDate();
      fetch(`https://www.twse.com.tw/exchangeReport/MI_INDEX20?&date=${date}`)
        .then((res) => {
          const data = res.json();
          return data;
        })
        .then((result) => {

          console.log(result);
          let data = result.data;
          let tableTitle = result.fields;

          let container = document.getElementById(`${idname}`);
          let table = document.createElement("table");
          table.classList.add("top20table");
          table.setAttribute("border", "1");

          // 取欄位名稱
          // console.log(tableTitle);

          let row = table.insertRow();
          for (let i = 0; i < tableTitle.length - 2; i++) {
            if (i == 4 || i == 6 || i == 7 || i == 9) { continue }
            let th = document.createElement("th");
            th.innerHTML = tableTitle[i];
            row.appendChild(th);
          }
          container.appendChild(table);

          // 取資料
          for (let i = 0; i < data.length; i++) {
            let tableRow = table.insertRow();

            for (let j = 0; j < data[i].length - 2; j++) {
              if (j == 4 || j == 6 || j == 7 || j == 9) {
                continue
              }

              let rowCell = tableRow.insertCell();
              if (j == 10) {
                if (parseFloat(data[i][8]) - parseFloat(data[i][5]) > 0) {
                  rowCell.innerHTML = `<span style='color:red'>+${(parseFloat(data[i][8]) - parseFloat(data[i][5])).toFixed(2)}</span>`
                } else if (parseFloat(data[i][8]) - parseFloat(data[i][5]) < 0) {
                  rowCell.innerHTML = `<span style='color:green'>${(parseFloat(data[i][8]) - parseFloat(data[i][5])).toFixed(2)}</span>`
                } else {
                  rowCell.innerHTML = (parseFloat(data[i][8]) - parseFloat(data[i][5])).toFixed(2)
                }
              } else {
                rowCell.innerHTML = data[i][j];
              }


            }
          }

        });

    }

    document.getElementById("searchStockBtn").onclick = function () {
      let stockNum = document.getElementById("searchStock").value;

      date = getTodayDate();

      getTenDay(date, stockNum)
    }

    window.onload = function () {
      let date = getLastTradeDate();
      // console.log(date);
      document.getElementsByClassName("top20Title")[0].innerHTML = `${date} 成交股數前20名`

      // top20stocks("top20");
    }

    let teststocks = [
      {
        "title": "2330",
        "data": [
          [
            "112/02/01",
            "42,539,626",
            "22,450,948,467",
            "532.00",
            "533.00",
            "522.00",
            "530.00",
            "+8.00",
            "31,487"
          ],
          [
            "112/02/02",
            "46,523,592",
            "25,091,483,557",
            "538.00",
            "542.00",
            "537.00",
            "540.00",
            "+10.00",
            "45,495"
          ],
          [
            "112/02/03",
            "34,156,234",
            "18,439,613,447",
            "540.00",
            "542.00",
            "536.00",
            "542.00",
            "+2.00",
            "39,674"
          ],
          [
            "112/02/06",
            "32,208,918",
            "17,041,821,849",
            "532.00",
            "533.00",
            "526.00",
            "526.00",
            "-16.00",
            "46,279"
          ],
          [
            "112/02/07",
            "24,362,116",
            "12,767,910,080",
            "524.00",
            "528.00",
            "522.00",
            "523.00",
            "-3.00",
            "28,519"
          ],
          [
            "112/02/08",
            "37,633,169",
            "20,247,927,642",
            "538.00",
            "540.00",
            "534.00",
            "540.00",
            "+17.00",
            "43,495"
          ],
          [
            "112/02/09",
            "22,311,345",
            "12,026,317,167",
            "540.00",
            "540.00",
            "536.00",
            "540.00",
            " 0.00",
            "19,698"
          ],
          [
            "112/02/10",
            "30,445,088",
            "16,545,221,176",
            "544.00",
            "546.00",
            "541.00",
            "545.00",
            "+5.00",
            "40,984"
          ],
          [
            "112/02/13",
            "23,903,151",
            "12,921,896,752",
            "544.00",
            "544.00",
            "538.00",
            "541.00",
            "-4.00",
            "22,431"
          ],
          [
            "112/02/14",
            "23,855,974",
            "12,990,943,260",
            "544.00",
            "546.00",
            "543.00",
            "545.00",
            "+4.00",
            "27,983"
          ],
          [
            "112/02/15",
            "66,068,713",
            "34,751,111,404",
            "526.00",
            "532.00",
            "522.00",
            "525.00",
            "-20.00",
            "103,433"
          ],
          [
            "112/02/16",
            "33,509,968",
            "17,692,691,883",
            "528.00",
            "531.00",
            "524.00",
            "528.00",
            "+3.00",
            "27,033"
          ],
          [
            "112/02/17",
            "29,673,053",
            "15,385,668,299",
            "524.00",
            "524.00",
            "516.00",
            "518.00",
            "-10.00",
            "55,965"
          ],
          [
            "112/02/20",
            "21,181,235",
            "10,928,087,780",
            "514.00",
            "519.00",
            "511.00",
            "517.00",
            "-1.00",
            "25,898"
          ],
          [
            "112/02/21",
            "14,135,509",
            "7,276,212,253",
            "515.00",
            "517.00",
            "513.00",
            "516.00",
            "-1.00",
            "27,195"
          ]
        ]
      },
      {
        "title": "9942",
        "data": [
          [
            "112/02/01",
            "524,005",
            "57,761,830",
            "108.50",
            "112.00",
            "108.00",
            "111.00",
            "+2.50",
            "551"
          ],
          [
            "112/02/02",
            "936,425",
            "105,656,766",
            "112.00",
            "115.00",
            "111.00",
            "112.50",
            "+1.50",
            "758"
          ],
          [
            "112/02/03",
            "361,861",
            "40,969,375",
            "111.50",
            "114.50",
            "111.50",
            "113.00",
            "+0.50",
            "342"
          ],
          [
            "112/02/06",
            "446,114",
            "50,562,090",
            "114.00",
            "114.50",
            "112.50",
            "112.50",
            "-0.50",
            "368"
          ],
          [
            "112/02/07",
            "302,699",
            "34,250,359",
            "113.00",
            "114.00",
            "112.50",
            "113.50",
            "+1.00",
            "307"
          ],
          [
            "112/02/08",
            "498,526",
            "57,011,895",
            "114.00",
            "115.00",
            "113.00",
            "115.00",
            "+1.50",
            "453"
          ],
          [
            "112/02/09",
            "694,417",
            "80,888,091",
            "116.00",
            "118.00",
            "115.00",
            "115.50",
            "+0.50",
            "583"
          ],
          [
            "112/02/10",
            "472,906",
            "54,385,413",
            "116.50",
            "116.50",
            "113.50",
            "115.50",
            " 0.00",
            "479"
          ],
          [
            "112/02/13",
            "1,160,594",
            "136,685,601",
            "116.00",
            "119.50",
            "116.00",
            "118.50",
            "+3.00",
            "759"
          ],
          [
            "112/02/14",
            "686,341",
            "81,831,913",
            "119.00",
            "120.50",
            "118.00",
            "118.00",
            "-0.50",
            "593"
          ],
          [
            "112/02/15",
            "205,611",
            "24,341,659",
            "118.00",
            "119.50",
            "117.50",
            "118.00",
            " 0.00",
            "205"
          ],
          [
            "112/02/16",
            "375,999",
            "44,136,214",
            "118.50",
            "118.50",
            "116.00",
            "118.00",
            " 0.00",
            "272"
          ],
          [
            "112/02/17",
            "430,960",
            "50,958,784",
            "118.00",
            "119.00",
            "117.00",
            "118.50",
            "+0.50",
            "259"
          ],
          [
            "112/02/20",
            "918,512",
            "111,894,505",
            "120.00",
            "125.00",
            "118.50",
            "123.00",
            "+4.50",
            "1,006"
          ],
          [
            "112/02/21",
            "361,838",
            "44,337,584",
            "124.00",
            "124.50",
            "121.00",
            "122.00",
            "-1.00",
            "391"
          ]
        ]
      }
    ]

  </script>
</body>

</html>